# âš¡ë°°í¬ ê°€ì´ë“œ
- NginxëŠ” ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šì€ ìƒíƒœ. (ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ë©´ ì™„ì „ ì‚­ì œ)
- ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆê°€ ì—†ëŠ” ìƒíƒœ (`docker ps`ë¡œ í™•ì¸)
- ì¶”ê°€ì ì¸ í¬íŠ¸ ì ìœ ê°€ ì—†ëŠ” ìƒíƒœ (`netstat -lntp`ë¡œ í™•ì¸)

<br>

# 1ï¸âƒ£SSL ì¸ì¦ì„œ ë°œê¸‰ ë° ì ìš©
- ì˜¤í”ˆë¹„ë‘ ê°™ì€ ê²½ìš°, ì¹´ë©”ë¼ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë°˜ë“œì‹œ httpsë¡œ ì´ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, SSLì¸ì¦ì„œë¥¼ ë°œê¸‰ ë°›ì•„ì•¼ í•œë‹¤. 
- ì¸ì¦ì„œ ë°œê¸‰ì„ ìœ„í•´ì„œëŠ” ë„ë©”ì¸ì´ í•„ìš”í•˜ë‹¤.
- SSL ì¸ì¦ì„œ ë°œê¸‰ ì‹œ, 80 ë˜ëŠ” 443 í¬íŠ¸ê°€ ë°©í™”ë²½ì—ì„œ ì—´ë ¤ìˆëŠ”ì§€ í™•ì¸í•˜ì.
    - ë˜ëŠ” ë°°í¬í•˜ëŠ” ê³¼ì •ì—ì„œ `ufw disable`ì„ í†µí•´ ë°©í™”ë²½ ì„¤ì •ì„ í•´ì œí•˜ê³ , ì¶”í›„ ë‹¤ì‹œ ë‹«ëŠ” ê²ƒìœ¼ë¡œ í•˜ì.
- Let's Encryptì—ì„œ ë°œê¸‰í•˜ëŠ” ê³¼ì •ì—ì„œ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì´ë‹¤.

```shell
sudo apt-get install letsencrypt
sudo letsencrypt certonly --standalone -d <ë„ë©”ì¸ëª…:i11b206.p.ssafy.io>
```

<img src="./images/guide-image.png" alt="description" width="500"/>


<br>

# 2ï¸âƒ£Openvidu ë°°í¬
### ì˜¤í”ˆ ë¹„ë‘ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•œ ê¶Œí•œ ì–»ê¸°
```shell
sudo su
```

### ì˜¤í”ˆë¹„ë‘ë¥¼ ì„¤ì¹˜í•˜ê¸° ìœ„í•´ /optë¡œ ì´ë™
```shell
cd /opt
```

### ì˜¤í”ˆë¹„ë‘ ì„¤ì¹˜
- ì•ŒíŒŒ ë²„ì „ ì¤‘ ê°€ì¥ ìµœì‹  ë²„ì „ ì‚¬ìš© (2024-08-24)
```shell
curl <https://s3-eu-west-1.amazonaws.com/aws.openvidu.io/install_openvidu_2.30.0.sh> | bash
```

### ì˜¤í”ˆë¹„ë‘ ì„¤ì¹˜ ê²½ë¡œë¡œ ì´ë™
```shell
cd openvidu
```

### .env í™˜ê²½ ì„¤ì •

```shell
nano .env
```
ë¡œ ì„¤ì • íŒŒì¼ ë²„í¼ë¡œ ì—´ê¸°
- ì¼ë‹¨ HTTPì™€ HTTPS ì„¤ì •ì„ í•˜ì§€ ì•Šê³  defaultë¡œ ì„¤ì •í•˜ì—¬ ì‹¤í–‰í•´ë³¸ë‹¤.
- ì•„ë˜ ë‚´ìš©ì„ íŒ€ì˜ ìƒí™©ì— ë§ì¶°ì„œ ì‘ì„±í•´ì£¼ì–´ì•¼ í•œë‹¤.
- `CERTIFICATE_TYPE=letsencrypt`ë¥¼ ì„¤ì •í•˜ì—¬ ìë™ìœ¼ë¡œ SSL ì¸ì¦ì„œê°€ ì ìš©ë˜ê²Œ í•œë‹¤.

```shell
# OpenVidu configuration
# ----------------------
# ë„ë©”ì¸ ë˜ëŠ” í¼ë¸”ë¦­IP ì£¼ì†Œ
DOMAIN_OR_PUBLIC_IP=i11b206.p.ssafy.io

# ì˜¤í”ˆë¹„ë‘ ì„œë²„ì™€ í†µì‹ ì„ ìœ„í•œ ì‹œí¬ë¦¿
OPENVIDU_SECRET=ssafyB206

# Certificate type
CERTIFICATE_TYPE=letsencrypt

# ì¸ì¦ì„œ íƒ€ì…ì´ letsencryptì¼ ê²½ìš° ì´ë©”ì¼ ì„¤ì •
LETSENCRYPT_EMAIL=seminkim1432@gmail.com
```

### ì‹¤í–‰ ë° ì¢…ë£Œ
```shell
# ì‹¤í–‰
./openvidu start

# ì¢…ë£Œ
./openvidu stop
```
- ì‹¤í–‰í•´ë³´ë©´, ì„¤ì •í•œ ë„ë©”ì¸ì„ ê¸°ë°˜ìœ¼ë¡œ ì ‘ì†í•  ìˆ˜ ìˆëŠ” ë§í¬ê°€ ë‚˜ì˜¨ë‹¤. 
- openvidu í˜ì´ì§€ì— ì ‘ì†ì´ ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì.
- ì„±ê³µì´ ë˜ì—ˆë‹¤ë©´ `netstat -lntp`ë¡œ í¬íŠ¸ë¥¼ í™•ì¸í•´ë³´ì.
- í¬íŠ¸ í™•ì¸ ì‹œ ì„±ê³µì ìœ¼ë¡œ 80ê³¼ 443ì´ nginxì— ì˜í•´ ì‚¬ìš©ë˜ê³  ìˆë‹¤ë©´ í™•ì¸ì„ ë§ˆì¹˜ê³  openviduë¥¼ ì¢…ë£Œí•˜ì.
- ìš°ë¦¬ê°€ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ í˜ì´ì§€ëŠ” openviduê°€ ì œê³µí•˜ëŠ” í˜ì´ì§€ê°€ ì•„ë‹Œ, ìš°ë¦¬ íŒ€ì˜ í”„ë¡ íŠ¸ í˜ì´ì§€ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, ë³€ê²½í•  ê²ƒì´ë‹¤.

<img src="./images/guide-image1.png" alt="description" width="500"/>


### .env íŒŒì¼ ì¬ì„¤ì •
```shell
nano .env
```
- ì´ë²ˆì—ëŠ” HTTPì™€ HTTPS ì„¤ì •ì„ í•œë‹¤.
- ì´ ì„¤ì •ì´ í•„ìš”í•œ ì´ìœ ëŠ”, openvidu ì„¤ì •ì´ ë‹´ê¸´ nginx ì„¤ì •ì— sslì„ ì¶”ê°€í•˜ê¸° ìœ„í•¨ì´ë‹¤.
- ssl ì„¤ì •ì„ ìœ„í•´ì„œëŠ” keyê°€ í•„ìš”í•œë°, ì•ì„œ ì„¤ì •í•œ `CERTIFICATE_TYPE=letsencrypt` ë•ë¶„ì— ìë™ìœ¼ë¡œ ì¸ì¦ì´ ì„¤ì •ëœë‹¤.
- ê·¸ë¦¬ê³  ì´ ì„¤ì •ì´ ì§„í–‰ë˜ì–´ì•¼ ì—¬ëŸ¬ ëª…ì´ í•˜ë‚˜ì˜ ì„¸ì…˜ì— ë“¤ì–´ê°€ í†µì‹ í•  ìˆ˜ ìˆë‹¤.
- ì´ë ‡ê²Œ ì™¸ë¶€ì—ì„œ í‚¤ë¥¼ ë°›ì•„ì˜¤ê¸° ìœ„í•´ì„œ ì‚¬ìš©ìì˜ í”„ë¡ íŠ¸ì™€ ë°±ì—”ë“œê°€ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸ë¥¼ í”¼í•´ì„œ HTTPì™€ HTTPS í¬íŠ¸ë¥¼ ì„¤ì •í•´ì•¼ í•œë‹¤.
```shell
# HTTP port
HTTP_PORT=8442

# HTTPS port
HTTPS_PORT=8443
```

### ì‹¤í–‰ ë° í¬íŠ¸ í™•ì¸
```shell
# ì‹¤í–‰
./openvidu start

# í¬íŠ¸ í™•ì¸
netstat -lntp
```
- ì´ì „ì—ëŠ” 80, 443í¬íŠ¸ë¥¼ Nginxê°€ ì ìœ í•˜ê³  ìˆì—ˆë‹¤ë©´, ì§€ê¸ˆì€ 8442, 8443 í¬íŠ¸ê°€ ì ìœ í•˜ê³  ìˆì–´ì•¼ í•œë‹¤.

<img src="./images/guide-image2.png" alt="description" width="500"/>

### ì„¤ì • í›„ ì˜¤í”ˆë¹„ë‘ ë°°í¬
```shell
docker-compose up -d
```

ìœ„ ê³¼ì •ì´ ì„±ê³µí–ˆë‹¤ë©´, 
- USER : OPENVIDUAPP
- ë¹„ë°€ë²ˆí˜¸ : ssafyB206
- `:8443/dashboard`ë¡œ í•˜ì—¬ ëŒ€ì‹œë³´ë“œ ì ‘ì†ì´ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.

<br>


# 3ï¸âƒ£í”„ë¡œì íŠ¸ ì„¤ì • + ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±

## ğŸ“ŒGit
- ê³„ì • ë° í† í° ë°œê¸‰
```shell
git clone https://github.com/Tasty-Ties/Tasty-Ties.git
```

<br>

## ğŸ“ŒDockerHub
- DockerHub ì ‘ì† ë° ê°€ì…
- ì—‘ì„¸ìŠ¤ í† í° ìƒì„±
- ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì˜¬ë¦¬ê³  ë‚´ë ¤ë°›ì•„ docker-composeë¥¼ í†µí•´ ë°°í¬í•œë‹¤.
    - ì´ë¥¼ í†µí•´, ì¶”í›„ ë¡œì»¬ì—ì„œ ë¹Œë“œí•œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë°°í¬ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

```shell
docker login -u <ê³„ì •:seminss>
```

<br>

## ğŸ“Œë©”ì¸ì„œë²„(tastyties)
>  Java17, Springboot 3.2
- ë¡œì»¬ì—ì„œë„ ì§„í–‰ ê°€ëŠ¥í•˜ë‹¤. (ì¸í…”ë¦¬ì œì´ ê°€ëŠ¥)

### Dockerfile ì‘ì„±
- í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì— ì‘ì„±í•œë‹¤.
```shell
# Start with a base image containing Java runtime
FROM openjdk:17-jdk-slim

# Add a volume pointing to /tmp
VOLUME /tmp

# Make port 8080 available to the world outside this container
EXPOSE 8080

# The application's jar file
ARG JAR_FILE=build/libs/tastyties-0.0.1-SNAPSHOT.jar

# Add the application's jar to the container
COPY ${JAR_FILE} app.jar

COPY ./src/main/resources/data.sql /app/resources/data.sql

# Run the jar file
ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]
                                                             
```

### security ì„¤ì •
- ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì ìš© ì¤‘ì´ë¼ë©´, í•´ë‹¹ ì£¼ì†Œë¥¼ í—ˆìš©í•´ì•¼ ì ‘ì†ì´ ê°€ëŠ¥í•˜ë‹¤.
- `backend/tastyties/src/main/java/com/teamcook/tastyties/security/config/SecurityConfig.java`
```java
configuration.addAllowedOrigin("https://i11b206.p.ssafy.io");
```
### application.propertiesëŠ” í™˜ê²½ ë³€ìˆ˜ë¡œ êµ¬ì„±í•œë‹¤.
- `backend/tastyties/src/main/resources/application.properties` ì°¸ê³ 

### .env ì„¤ì •
- ë¹Œë“œë¥¼ ìœ„í•´ application.propertiesì— í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ í• ë‹¹í•œë‹¤.
- ë§Œì•½ ë¡œì»¬ì—ì„œ ë¹Œë“œë¥¼ ì§„í–‰í•  ì˜ˆì •ì´ë¼ë©´, ë¡œì»¬ í™˜ê²½ì— ë§ì¶° ì§€ì •í•˜ì.
```shell
#ë¡œì»¬ì— ëŒ€í•œ ì„¤ì •
SERVER_PORT=8080
SERVER_SSL_ENABLED=false
OPENVIDU_URL=http://localhost:4443/
OPENVIDU_SECRET=MY_SECRET
DB_URL=jdbc:mysql://localhost:3306/tastyties
DB_USERNAME=
DB_PASSWORD=
ADMIN_PWD=
JWT_SECRET=
JWT_ACCESS_TOKEN_EXPIRATION=360000
JWT_REFRESH_TOKEN_EXPIRATION=604800000
UPLOAD_IMAGE_DIR=C:\\Users\\SSAFY\\ssafy\\files\\image
UPLOAD_VIDEO_DIR=C:\\Users\\SSAFY\\ssafy\\files\\video
FILE_SERVER_URL=http://localhost:8080/api/v1
REDIS_HOST=localhost
REDIS_PORT=6379
AWS_ACCESS_KEY=
AWS_SECRET_KEY=
AWS_BUCKET_NAME=
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USERNAME=guest
RABBITMQ_PASSWORD=guest
```

### í…ŒìŠ¤íŠ¸ ì œì™¸í•˜ê³  ë¹Œë“œ
- í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì—ì„œ ì§„í–‰í•œë‹¤. (build.gradleì´ ìˆëŠ” ìœ„ì¹˜)
```shell
./gradlew build -x test
```

### ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±
```shell
docker build --no-cache -t seminss/tastyties:latest .
docker build --no-cache -t <ê³„ì •ëª…>/<ì´ë¯¸ì§€ëª…>:<íƒœê·¸ëª…> .
```

### ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
```shell
docker push seminss/tastyties:latest
docker push <ê³„ì •ëª…>/<ì´ë¯¸ì§€ëª…>:<íƒœê·¸ëª…>
```

<br>

## ğŸ“Œì±„íŒ…ì„œë²„(tastyties)
>  Java17, Springboot 3.2
- ë¡œì»¬ì—ì„œë„ ì§„í–‰ ê°€ëŠ¥í•˜ë‹¤. (ì¸í…”ë¦¬ì œì´ ê°€ëŠ¥)

### Dockerfile ì‘ì„±
- í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì— ì‘ì„±í•œë‹¤.
```shell
# Start with a base image containing Java runtime
FROM openjdk:17-jdk-slim

# Add a volume pointing to /tmp
VOLUME /tmp

# Make port 8081 available to the world outside this container
EXPOSE 8081

# The application's jar file
ARG JAR_FILE=build/libs/tastytieschat-0.0.1-SNAPSHOT.jar

# Add the application's jar to the container
COPY ${JAR_FILE} app.jar

# Run the jar file
ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"]
                                                             
```

### security ì„¤ì •
- ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì ìš© ì¤‘ì´ë¼ë©´, í•´ë‹¹ ì£¼ì†Œë¥¼ í—ˆìš©í•´ì•¼ ì ‘ì†ì´ ê°€ëŠ¥í•˜ë‹¤.
- `backend/tastytieschat/src/main/java/com/teamcook/tastyties/security/config/SecurityConfig.java`
```java
configuration.addAllowedOrigin("https://i11b206.p.ssafy.io");
```
### application.propertiesëŠ” í™˜ê²½ ë³€ìˆ˜ë¡œ êµ¬ì„±í•œë‹¤.
- `backend/tastytieschat/src/main/resources/application.properties` ì°¸ê³ 

### .env ì„¤ì •
- ë¹Œë“œë¥¼ ìœ„í•´ application.propertiesì— í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ í• ë‹¹í•œë‹¤.
- ë§Œì•½ ë¡œì»¬ì—ì„œ ë¹Œë“œë¥¼ ì§„í–‰í•  ì˜ˆì •ì´ë¼ë©´, ë¡œì»¬ í™˜ê²½ì— ë§ì¶° ì§€ì •í•˜ì.
```shell
#ë¡œì»¬ì— ëŒ€í•œ ì„¤ì •
SERVER_PORT=8081
DB_URL=jdbc:mysql://localhost:3306/tastyties
DB_USERNAME=
DB_PASSWORD=
MONGO_HOST=localhost
MONGO_PORT=27017
MONGO_DATABASE=
MONGO_USERNAME=
MONGO_PASSWORD=
REDIS_HOST=localhost
REDIS_PORT=6379
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USERNAME=guest
RABBITMQ_PASSWORD=guest
OPENAI_SECRET_KEY=
SPEECH_FLOW_KEY_ID=
SPEECH_FLOW_KEY_SECRET=
CLOVA_CLIENT_ID=
CLOVA_CLIENT_SECRET=
```

### í…ŒìŠ¤íŠ¸ ì œì™¸í•˜ê³  ë¹Œë“œ
- í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì—ì„œ ì§„í–‰í•œë‹¤. (build.gradleì´ ìˆëŠ” ìœ„ì¹˜)
```shell
./gradlew build -x test
```

### ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±
```shell
docker build --no-cache -t seminss/tastytieschat:latest .
docker build --no-cache -t <ê³„ì •ëª…>/<ì´ë¯¸ì§€ëª…>:<íƒœê·¸ëª…> .
```

### ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
```shell
docker push seminss/tastytieschat:latest
docker push <ê³„ì •ëª…>/<ì´ë¯¸ì§€ëª…>:<íƒœê·¸ëª…>
```

<br>

## ğŸ“Œí”„ë¡ íŠ¸ì„œë²„ + Nginx
>  React

### nginx.conf ì‘ì„±
- í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì— ì‘ì„±í•œë‹¤.
- `/app/dist`ëŠ” ë¹Œë“œ íŒŒì¼ ìœ„ì¹˜ë‹¤. 
```
server {
    listen 3000;
    server_name localhost;

    location / {
        root /app/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
    }
}
```
### Dockerfile ì‘ì„±
- í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì— ì‘ì„±í•œë‹¤.
```shell
# Dockerfile

# nginx ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•œë‹¤. ë’¤ì— tagê°€ ì—†ìœ¼ë©´ latest ë¥¼ ì‚¬ìš©í•œë‹¤.
FROM nginx

# root ì— app í´ë”ë¥¼ ìƒì„±
RUN mkdir /app

# work dir ê³ ì •
WORKDIR /app

# work dir ì— build í´ë” ìƒì„± /app/build
RUN mkdir ./build

# host pcì˜ í˜„ì¬ê²½ë¡œì˜ build í´ë”ë¥¼ workdir ì˜ build í´ë”ë¡œ ë³µì‚¬
COPY ./dist ./dist

# nginx ì˜ default.conf ë¥¼ ì‚­ì œ
RUN rm /etc/nginx/conf.d/default.conf

# host pc ì˜ nginx.conf ë¥¼ ì•„ë˜ ê²½ë¡œì— ë³µì‚¬
COPY ./nginx.conf /etc/nginx/conf.d

# 3000 í¬íŠ¸ ì˜¤í”ˆ
EXPOSE 3000

# container ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ ì‹¤í–‰í•  command. nginx ì‹œì‘í•¨
CMD ["nginx", "-g", "daemon off;"]

```

### .env ì„¤ì •
- ë°°í¬ í™˜ê²½ì— ë§ê²Œ ì‘ì„±í•œë‹¤.
```
VITE_MAIN_SERVER=https://i11b206.p.ssafy.io/api/v1
VITE_FRONT_SERVER=https://i11b206.p.ssafy.io/
VITE_CHAT_SERVER=wss://i11b206.p.ssafy.io/chat
VITE_CHAT_SERVER_URL=https://i11b206.p.ssafy.io/chatapi

# firebase
VITE_FIREBASE_API_KEY=
VITE_FIREBASE_AUTO_DOMAIN=
VITE_FIREBASE_PROJECT_ID=
VITE_FIREBASE_STORAGE_BUCKET=
VITE_FIREBASE_MESSAGING_SENDER_ID=
VITE_FIREBASE_APP_ID=
VITE_FIREBASE_VAPID_KEY=
```

### ë¹Œë“œ
- í”„ë¡œì íŠ¸ ìµœìƒë‹¨ì—ì„œ ì§„í–‰í•œë‹¤.
```shell
npm run build
```

### ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±
```shell
docker build -t seminss/frontend:npm <íƒœê·¸> .
docker build -t seminss/frontend:latest .
```

### ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ
```shell
docker push seminss/frontend:<íƒœê·¸>
docker push seminss/frontend:latest
```

<br>

# 4ï¸âƒ£ì–´í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
#### `ë©”ì¸ ì„œë²„`, `ì±„íŒ… ì„œë²„`, `í”„ë¡ íŠ¸ ì„œë²„`, `Redis`, `RabbitMQ`, `MySQL`, `MongoDB`ì— ëŒ€í•˜ì—¬, **DockerHub & docker-compose** ë¥¼ ì´ìš©í•œ ë°°í¬

### ë„¤íŠ¸ì›Œí¬ ìƒì„±
- ë„ì»¤ ì»¨í…Œì´ë„ˆê°€ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ ìƒì—ì„œ ë™ì‘í•˜ë„ë¡ í•˜ê¸° ìœ„í•¨ì´ë‹¤.
- ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ë„¤íŠ¸ì›Œí¬ë¥¼ ë¯¸ë¦¬ ìƒì„±í•´ì£¼ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬ê°€ ë‚œë‹¤.
```shell
docker network create shared_network
```

### docker-compose.yml íŒŒì¼ ì‘ì„±
- ì•ì„œ .env íŒŒì¼ì— ì„¤ì •í•´ë‘” í™˜ê²½ ë³€ìˆ˜ ê°’ì´ ë¡œì»¬ í™˜ê²½ì„ ìœ„í•œ ê²ƒ(ë¹Œë“œë¥¼ ìœ„í•œ ê²ƒ) ì´ì—ˆë‹¤ë©´, ì´ì œëŠ” ì •ë§ ë°°í¬ë¥¼ ìœ„í•œ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •í•œë‹¤.
- ì•ì„œ ì„¤ì •í•œ í™˜ê²½ ë³€ìˆ˜ëŠ” docker-composeì— ì˜í•´ ë®ì–´ ì”Œì›Œì§„ë‹¤.

```yml
services:
  frontend:
    image: seminss/frontend:latest #ì•ì„œ ë„ì»¤ í—ˆë¸Œì— ì˜¬ë¦° ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•œë‹¤.
    container_name: frontend #ì»¨í…Œì´ë„ˆ ì´ë¦„
    restart: always
    ports:
      - "3000:3000"
    networks:
      - shared_network
  
  tastyties:
    image: seminss/tastyties:latest
    container_name: tastyties
    restart: always
    ports:
      - "8080:8080"
    depends_on: #tastyties ì»¨í…Œì´ë„ˆê°€ ì˜¬ë¼ê°€ê¸° ì „ì— ë¯¸ë¦¬ ì˜¬ë¼ê°€ì•¼ í•˜ëŠ” ì»¨í…Œì´ë„ˆ ì§€ì •.
      - db
      - redis
      - rabbitmq
    environment:
      SERVER_PORT: 8080
      OPENVIDU_URL: https://i11b206.p.ssafy.io:8443/ #ì•ì„œ ì„¤ì •í•œ ì˜¤í”ˆë¹„ë‘ì˜ https í¬íŠ¸ë¡œ ì§€ì •
      OPENVIDU_SECRET: #ì˜¤í”ˆë¹„ë‘ ì‹œí¬ë¦¿ í‚¤, ì„ì˜ ì„¤ì •
      DB_URL: jdbc:mysql://db:3306/tastyties #dbë¼ëŠ” ì»¨í…Œì´ë„ˆì—ì„œ tastytiesë¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤
      DB_USERNAME: # mysql ê³„ì •
      DB_PASSWORD: # mysql PWD
      UPLOAD_IMAGE_DIR: /app/files/image
      UPLOAD_VIDEO_DIR: /app/files/video
      FILE_SERVER_URL: http://localhost:8080/api/v1/files
      REDIS_HOST: redis
      REDIS_PORT: 6379
      AWS_ACCESS_KEY: #S3 ACCESS KEY
      AWS_SECRET_KEY: #S3 SECRET KEY
      AWS_BUCKET_NAME: #S3 ë²„í‚· ì´ë¦„
      RABBITMQ_HOST: rabbitmq
      RABBITMQ_PORT: 5672
      RABBITMQ_USERNAME: # RabbitMQëŠ” ë°°í¬ í™˜ê²½ì—ì„œ guestë¡œ ì ‘ì† ë¶ˆê°€, ë³„ë„ì˜ admin ê³„ì • ìƒì„±
      RABBITMQ_PASSWORD: # RabbitMQ PWD
      ADMIN_PWD: #ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ê´€ë¦¬ì ê³„ì • PWD
    volumes:
      - /home/ubuntu/b206/S11P12B206/backend/tastyties/tastyties/src/main/resources/serviceAccountKey.json:/src/main/resources/serviceAccountKey.json #íŒŒì´ì–´ë² ì´ìŠ¤ í‚¤ ë³¼ë¥¨ ì„¤ì •
    networks:
      - shared_network

  tastytieschat:
    image: seminss/tastytieschat:latest
    container_name: tastytieschat
    restart: always
    ports:
      - "8081:8081"
    depends_on:
      - mongo
      - rabbitmq
      - redis
    environment:
      SERVER_PORT: 8081
      DB_URL: jdbc:mysql://db:3306/tastyties
      DB_USERNAME: # mysql ê³„ì •
      DB_PASSWORD: # mysql PWD
      MONGO_HOST: mongo
      MONGO_PORT: 27017
      MONGO_DATABASE: tastyties
      MONGO_USERNAME: # mongoDB ê³„ì •
      MONGO_PASSWORD: # mongoDB PWD
      RABBITMQ_HOST: rabbitmq
      RABBITMQ_PORT: 5672
      RABBITMQ_USERNAME: # RabbitMQ admin ê³„ì •
      RABBITMQ_PASSWORD: # RabbitMQ admin PWD
      OPENAI_SECRET_KEY: # OPEN AI (GPT) SECRET KEY
      SPEECH_FLOW_KEY_ID: # í´ë¡œë°” CLIENT SCERET(í˜„ì¬ëŠ” ì‚¬ìš© x)
      SPEECH_FLOW_KEY_SECRET: # í´ë¡œë°” CLIENT SCERET(í˜„ì¬ëŠ” ì‚¬ìš© x)
      FFMPEG_PATH: /usr/local/bin/ffmpeg # (í˜„ì¬ëŠ” ì‚¬ìš© x)
      CLOVA_CLIENT_ID: # í´ë¡œë°” CLIENT SCERET(í˜„ì¬ëŠ” ì‚¬ìš© x)
      CLOVA_CLIENT_SECRET: # í´ë¡œë°” CLIENT SCERET(í˜„ì¬ëŠ” ì‚¬ìš© x)
      REDIS_HOST: redis
      REDIS_PORT: 6379
    volumes:
      - /home/ubuntu/b206/S11P12B206/backend/tastytieschat/src/main/resources/serviceAccountKey.json:/src/main/resources/serviceAccountKey.json
    networks:
      - shared_network

  db: #ì—¬ê¸°ì„œ ì„¤ì •í•œ ê±¸ í”„&ë°± ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒ
    image: mysql:8
    container_name: mysql
    environment:
      MYSQL_ROOT_PASSWORD: # mysql ë£¨íŠ¸ ë¹„ë°€ë²ˆí˜¸
      MYSQL_DATABASE: # ì‚¬ìš©í•  ë°ì´í„°ë² ì´ìŠ¤
      MYSQL_USER: # ì‚¬ìš©í•  ê³„ì •
      MYSQL_PASSWORD: # ì‚¬ìš©í•œ ê³„ì • PWD
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - shared_network

  mongo:
    image: mongo:latest
    container_name: mongo
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: # mongoDB ë£¨íŠ¸ ê³„ì • ì´ë¦„
      MONGO_INITDB_ROOT_PASSWORD: # mongoDB ë£¨íŠ¸ ë¹„ë°€ë²ˆí˜¸
    volumes:
      - mongo_data:/data/db
    networks:
      - shared_network

  rabbitmq:
    image: rabbitmq:management
    container_name: rabbitmq
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      RABBITMQ_DEFAULT_USER: # RabbitMQ admin ê³„ì •
      RABBITMQ_DEFAULT_PASS: # admin ê³„ì • ë¹„ë°€ë²ˆí˜¸
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
    networks:
      - shared_network

  redis:
    image: redis:latest
    container_name: redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes --save "900 1" --save "300 10" --save "60 10000"
    networks:
      - shared_network

volumes:
  mysql_data:
  mongo_data:
  redis_data:
  rabbitmq_data:
  tastytieschat:
  tastyties:

networks:
  shared_network:
    external: true
```

### ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```shell
docker-compose up -d
```
<img src="./images/guide-image4.png" alt="description" width="500"/>

ìµœì¢…ì ìœ¼ë¡œ ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆëŠ” ìœ„ì™€ ê°™ì•„ì•¼ í•œë‹¤.


<br>

# 5ï¸âƒ£nginx (ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)

### nginx ì„¤ì¹˜
```shell
# ì„¤ì¹˜
sudo apt-get install nginx

# ì„¤ì¹˜ í™•ì¸ ë° ë²„ì „ í™•ì¸
nginx -v
```
### nginx.conf
- `/etc/nginx.conf` ê¸°ë³¸ íŒŒì¼ì„ ì—°ë‹¤.
- ì£¼ìš” ë³€ê²½ ì 
    - userëŠ” rootë¡œ ë³€ê²½
    - httpì— `include /etc/nginx/conf.d/*.conf;` , `include /etc/nginx/sites-enabled/*;` ì™€ ê°™ì€ ë‘ includeë¥¼ ì§„í–‰
```shell
user root;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
        worker_connections 768;
}

http {

        ...

        access_log /var/log/nginx/access.log;
        error_log /var/log/nginx/error.log;

        ...

        include /etc/nginx/conf.d/*.conf;
        include /etc/nginx/sites-enabled/*;
}

```

### deploy-test.conf
- `/ect/nginx/sites-available/deploy-test.conf`
- íŒŒì¼ ëª…ì€ ì–¼ë§ˆë“ ì§€ ë³€ê²½ ê°€ëŠ¥, but nginx.confì— ë°˜ë“œì‹œ import í•´ì•¼ í•œë‹¤.
- `/etc/letsencrypt/live/i11b206.p.ssafy.io/fullchain.pem`ê³¼ `ssl_certificate_key /etc/letsencrypt/live/i11b206.p.ssafy.io/privkey.pem`ëŠ” ë°˜ë“œì‹œ ì§€ì •í•œ ê²½ë¡œì— ìˆëŠ”ì§€ í™•ì¸í•˜ì. ì•„ë‹ˆë¼ë©´ ì—ëŸ¬ê°€ ë‚œë‹¤.

```shell
upstream frontend {                                                                
    server localhost:3000;                                   
}                                                                  
                                                     
upstream backend {                                                                 
    server localhost:8080;                                                       
}                                                                                  
                                                                   
upstream chatend {
    server localhost:8081;                                                         
}      

server {
    listen 80;
    server_name i11b206.p.ssafy.io;

    # HTTP ìš”ì²­ì€ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ í• ê²Œìš”
    if ($host = i11b206.p.ssafy.io) {
        return 301 https://$host$request_uri;
    }

    return 404;
}

server {
    listen 443 ssl;
    server_name i11b206.p.ssafy.io;

    ssl_certificate /etc/letsencrypt/live/i11b206.p.ssafy.io/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/i11b206.p.ssafy.io/privkey.pem;

    root /home/ubuntu/b206/S11P12B206/frontend/gongtong_front;

    location / { #/ë¡œ ë“¤ì–´ì˜¤ë©´ frontend ì„œë²„ë¡œ ì—°ê²°í• ê²Œìš”
        proxy_pass http://frontend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # CORS settings
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, DELETE, PUT';
        add_header 'Access-Control-Allow-Headers' 'Authorization, Content-Type, X-Requested-With';

        if ($request_method = 'OPTIONS') {
            return 204;
        }
    }

    location /api/v1 { #/api/v1ë¡œ ë“¤ì–´ì˜¤ë©´ backend ì„œë²„ë¡œ ì—°ê²°í• ê²Œìš”
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # CORS settings
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, DELETE, PUT';
        add_header 'Access-Control-Allow-Headers' 'Authorization, Content-Type, X-Requested-With';

        if ($request_method = 'OPTIONS') {
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, DELETE, PUT';
            add_header 'Access-Control-Allow-Headers' 'Authorization, Content-Type, X-Requested-With';
            return 204;
        } 
   }

   location /chat { #/chatìœ¼ë¡œ ë“¤ì–´ì˜¤ë©´ ì±„íŒ… ì„œë²„ ì¤‘, ì›¹ì†Œì¼“ ì—°ê²°ì„ í• ê²Œìš”
        proxy_pass http://chatend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_read_timeout 3600s;
        proxy_send_timeout 3600s;
        proxy_buffering off;
    }

    location /chatapi {  #/chatapië¡œ ë“¤ì–´ì˜¤ë©´ ì±„íŒ… ì„œë²„ ì¤‘, REST API ì—°ê²°ì„ í• ê²Œìš”
        proxy_pass http://chatend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location = /favicon.ico {
        log_not_found off;
        access_log off;
    }
}
```
- `/api/v1`ìœ¼ë¡œ ì¡íŒ ê²ƒì€ ë©”ì¸ ì„œë²„, `/chat`ê³¼ `/chatapi`ëŠ” ì±„íŒ… ì„œë²„ë‹¤.
- ì±„íŒ… ì„œë²„ëŠ” ì›¹ì†Œì¼“ê³¼ REST APIë¥¼ ëª¨ë‘ ì œê³µí•œë‹¤. ë”°ë¼ì„œ ì›¹ì†Œì¼“ì€ `/chat/pub ..` `/chat/sub ..`ìœ¼ë¡œ ê²½ë¡œê°€ ì¡í˜€ ìˆì—ˆê³ , REST APIëŠ” `/chat/api/v1` ì™€ ê°™ì€ ê²½ë¡œë¥¼ ì‚¬ìš©í–ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ë ‡ê²Œ í•˜ë‹ˆ, ì±„íŒ… ì„œë²„ë¡œ ë“¤ì–´ê°€ëŠ” ìš”ì²­ì„ nginxì—ì„œ êµ¬ë¶„í•˜ì§€ ëª»í•´, í”„ë¡ íŠ¸ì˜ ìš”ì²­ì´ ë©”ì¸ì„œë²„ë¡œ ë“¤ì–´ê°€ 404ê°€ ëœ¨ëŠ” ë¬¸ì œ ë°œìƒí–ˆë‹¤. ë”°ë¼ì„œ ì±„íŒ… ì„œë²„ì˜ REST API ê²½ë¡œë¥¼ `/chatapi`ë¡œ êµ¬ë¶„í•˜ê²Œ ë˜ì—ˆë‹¤. 
- ë‹¤ì‹œ ëŒì•„ê°„ë‹¤ë©´ ë©”ì¸ ì„œë²„ì˜ context pathë¥¼ `/tastyties`, ì±„íŒ… ì„œë²„ì˜ context pathë¥¼ `/tastytieschat`ìœ¼ë¡œ ëª…í™•íˆ êµ¬ë¶„í•´ì„œ nginxì—ì„œ ìƒê¸¸ ë¬¸ì œë¥¼ ë¯¸ì—°ì— ë°©ì§€í•  ê²ƒì´ë‹¤.

### nginx ë™ì‘ í™•ì¸
```shell
systemctl status nginx
```
- nginxëŠ” dockerë¡œ ë„ìš°ì§€ ì•Šì•˜ë‹¤. ìš°ë¶„íˆ¬ì—ì„œ ë™ì‘í•œë‹¤.

<img src="./images/guide-image3.png" alt="description" width="500"/>

ë°°í¬ ëì…ë‹ˆë‹¤. :D

ë°°í¬ë¥¼ ì™„ë£Œí•œ ë’¤ ì°¸ê³ í• ë§Œí•œ ê°€ì´ë“œëŠ” `ë°°í¬ìƒì„¸.md`ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.

## 


### ì°¸ê³  ìë£Œ 
- https://roasted-pharaoh-ec9.notion.site/Openvidu-30add9273abf4cf8957ca0028ee48669
- https://github.com/yesfordev/homedong/blob/develop/git%20%EC%86%8C%EC%8A%A4%20%ED%81%B4%EB%A1%A0%20%EC%9D%B4%ED%9B%84%20%EB%B9%8C%EB%93%9C%20%EB%B0%8F%20%EB%B0%B0%ED%8F%AC%20%EA%B0%80%EC%9D%B4%EB%93%9C.md

ë¬¸ì˜ì‚¬í•­ì€ ê¹€ì„¸ë¯¼ì—ê²Œ(seminkim1432@gamil.com) ğŸ“§